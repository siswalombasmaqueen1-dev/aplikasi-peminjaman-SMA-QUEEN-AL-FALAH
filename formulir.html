<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulir Peminjaman</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #001f3f 0%, #003366 50%, #004080 100%);
      background-attachment: fixed;
      background-size: cover;
      color: white;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 30px 20px;
      min-height: 100vh;
      box-sizing: border-box;
    }

    form {
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(8px);
      padding: 30px;
      border-radius: 16px;
      width: 100%;
      max-width: 440px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.35);
      transition: all 0.3s ease;
    }

    form:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.45);
    }

    h2, h3 {
      text-align: center;
      margin-bottom: 25px;
      font-weight: 600;
    }

    label {
      display: block;
      margin-top: 15px;
      margin-bottom: 6px;
      font-weight: 500;
    }

    input, select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      margin-bottom: 20px;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      outline: 2px solid #39CCCC;
      background-color: rgba(255,255,255,0.15);
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(to right, #7FDBFF, #39CCCC);
      color: black;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    button:hover {
      background-color: red;
      color: white;
      transform: scale(1.03);
    }

    /* üîô Tombol kembali */
    .btn-keluar {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: linear-gradient(to right, #7FDBFF, #39CCCC);
      color: black;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .btn-keluar:hover {
      background: red;
      color: white;
      transform: scale(1.05);
    }

    #fasilitasSection {
      display: none;
      margin-top: 30px;
      border-top: 1px solid rgba(255,255,255,0.3);
      padding-top: 20px;
    }

    /* üåç Responsif */
    @media (max-width: 768px) {
      form {
        padding: 20px;
        border-radius: 12px;
      }

      h2, h3 {
        font-size: 20px;
      }

      button {
        font-size: 16px;
        padding: 12px;
      }
    }

    @media (max-width: 480px) {
      form {
        padding: 15px;
      }

      label {
        font-size: 14px;
      }

      input, select {
        font-size: 14px;
        padding: 10px;
      }

      button {
        font-size: 15px;
        padding: 12px;
      }

      .btn-keluar {
        font-size: 13px;
        padding: 8px 14px;
      }
    }
  </style>
</head>
<body>

  <form id="formulirPeminjaman">
    <h2>üìù Formulir Peminjaman</h2>

    <label for="peran">Peran</label>
    <select id="peran" name="peran" required>
      <option value="">-- Pilih Peran --</option>
      <option value="siswa">Siswa</option>
      <option value="guru">Guru</option>
    </select>

    <div id="formContainer"></div>

    <div id="fasilitasSection">
      <h3>üè´ Fasilitas yang Digunakan</h3>

      <label for="fasilitas">Fasilitas:</label>
      <select id="fasilitas" required>
        <option value="">-- Pilih fasilitas --</option>
        <option value="Lab Komputer">üñ•Ô∏è Lab Komputer</option>
        <option value="Lab Kimia">üß™ Lab Kimia</option>
        <option value="Lab Fisika">‚öõÔ∏è Lab Fisika</option>
        <option value="Proyektor">üìΩÔ∏è Proyektor</option>
        <option value="Laptop">üíª Laptop</option>
        <option value="Bola">üèÄ Bola</option>
        <option value="GOR">üèüÔ∏è GOR</option>
        <option value="Ruang Rapat">üè¢ Ruang Rapat</option>
        <option value="Studio">üé• Studio</option>
        <option value="Laptop Sekolah">üíª Laptop Sekolah</option>
        <option value="Kamera">üì∏ Kamera</option>
      </select>

      <div id="subFasilitasContainer" style="display:none;">
        <label for="subFasilitas">Detail Fasilitas:</label>
        <select id="subFasilitas" required></select>
      </div>

      <label for="jamMulai">Jam Peminjaman:</label>
      <select id="jamMulai" required></select>

      <label for="jamSelesai">Jam Selesai:</label>
      <select id="jamSelesai" required></select>

      <label for="keterangan">Keterangan:</label>
      <select id="keterangan" required>
        <option value="">-- Pilih Keterangan --</option>
        <option value="Bimbingan Lomba">Bimbingan Lomba</option>
        <option value="Materi Pelajaran">Materi Pelajaran</option>
        <option value="Lomba">Lomba</option>
      </select>

      <button type="submit">Tambah Data</button>
    </div>
  </form>

  <a href="index.html" class="btn-keluar">üè† Kembali</a>

  <script>
    const peranSelect = document.getElementById("peran");
    const formContainer = document.getElementById("formContainer");
    const fasilitasSection = document.getElementById("fasilitasSection");
    const fasilitasSelect = document.getElementById("fasilitas");
    const subFasilitasContainer = document.getElementById("subFasilitasContainer");
    const subFasilitasSelect = document.getElementById("subFasilitas");

    const jamPelajaran = [
      { no: 1, label: "Jam ke-1 (07.00 - 07.45)" },
      { no: 2, label: "Jam ke-2 (07.45 - 08.30)" },
      { no: 3, label: "Jam ke-3 (08.30 - 09.15)" },
      { no: 4, label: "Jam ke-4 (09.15 - 10.00)" },
      { no: 5, label: "Jam ke-5 (10.20 - 11.05)" },
      { no: 6, label: "Jam ke-6 (11.05 - 11.50)" },
      { no: 7, label: "Jam ke-7 (11.50 - 12.35)" },
      { no: 8, label: "Jam ke-8 (12.35 - 13.20)" },
    ];

    const jamMulaiSelect = document.getElementById("jamMulai");
    const jamSelesaiSelect = document.getElementById("jamSelesai");

    jamPelajaran.forEach(jam => {
      const option = document.createElement("option");
      option.value = jam.no;
      option.textContent = jam.label;
      jamMulaiSelect.appendChild(option);
    });

    jamMulaiSelect.addEventListener("change", () => {
      const jamMulai = parseInt(jamMulaiSelect.value);
      jamSelesaiSelect.innerHTML = '<option value="">-- Pilih Jam Selesai --</option>';
      jamPelajaran.filter(j => j.no > jamMulai).forEach(j => {
        const opt = document.createElement("option");
        opt.value = j.no;
        opt.textContent = j.label;
        jamSelesaiSelect.appendChild(opt);
      });
    });

    fasilitasSelect.addEventListener("change", function() {
      const fasilitas = this.value;
      subFasilitasSelect.innerHTML = '';
      subFasilitasContainer.style.display = 'none';

      if (fasilitas === "Lab Komputer") {
        subFasilitasContainer.style.display = 'block';
        subFasilitasSelect.innerHTML = `
          <option value="">-- Pilih Lab Komputer --</option>
          <option value="Lab Komputer 1">Lab Komputer 1</option>
          <option value="Lab Komputer 2">Lab Komputer 2</option>
          <option value="Lab Komputer 3">Lab Komputer 3</option>
        `;
      } else if (fasilitas === "Proyektor") {
        subFasilitasContainer.style.display = 'block';
        subFasilitasSelect.innerHTML = `
          <option value="">-- Pilih Proyektor --</option>
          ${Array.from({ length: 8 }, (_, i) => `<option value="Proyektor ${i+1}">Proyektor ${i+1}</option>`).join('')}
        `;
      } else if (fasilitas === "Bola") {
        subFasilitasContainer.style.display = 'block';
        subFasilitasSelect.innerHTML = `
          <option value="">-- Pilih Jenis Bola --</option>
          <option value="Bola Voli">Bola Voli</option>
          <option value="Bola Basket">Bola Basket</option>
          <option value="Bola Sepak">Bola Sepak</option>
        `;
      }
    });

    peranSelect.addEventListener("change", function() {
      const peran = this.value;
      formContainer.innerHTML = "";

      if (peran === "siswa") {
        formContainer.innerHTML = `
          <label for="nama">Nama</label>
          <input type="text" id="nama" name="nama" required />

          <label for="kelas">Kelas</label>
          <select id="kelas" name="kelas" required>
            <option value="">-- Pilih Kelas --</option>
            <optgroup label="Kelas 10">
              ${Array.from({ length: 13 }, (_, i) => `<option value="10-${i + 1}">10-${i + 1}</option>`).join('')}
            </optgroup>
            <optgroup label="Kelas 11">
              ${Array.from({ length: 13 }, (_, i) => `<option value="11-${i + 1}">11-${i + 1}</option>`).join('')}
            </optgroup>
            <optgroup label="Kelas 12">
              ${Array.from({ length: 13 }, (_, i) => `<option value="12-${i + 1}">12-${i + 1}</option>`).join('')}
            </optgroup>
          </select>

          <label for="absen">Absen</label>
          <input type="number" id="absen" name="absen" min="1" max="40" required />

          <label for="tanggal">Tanggal Peminjaman</label>
          <input type="date" id="tanggal" name="tanggal" required />
        `;
      } else if (peran === "guru") {
        formContainer.innerHTML = `
          <label for="nama">Nama Guru</label>
          <input list="daftar-guru" id="nama" name="nama" placeholder="Ketik nama guru..." required />
          <datalist id="daftar-guru">
            <option value="Achmad Muhshon, S.Pd.">
            <option value="Ayu Khoirunnisa, S.Pd">
            <option value="Dyah Umaya, S.Pd">
            <option value="Fina Laila Khoridah, S.Pd.">
            <option value="Gita Nurwahyuni, S.Pd.">
            <option value="Imam Sutopo, S.Pd.">
            <option value="H. Heri Purnomo, S.Pd.">
            <option value="Lilik Handayani, S.Pd.">
          </datalist>

          <label for="mapel">Mata Pelajaran</label>
          <select id="mapel" name="mapel" required>
            <option value="">-- Pilih Mata Pelajaran --</option>
            <option value="Matematika">Matematika</option>
            <option value="Fisika">Fisika</option>
            <option value="Kimia">Kimia</option>
            <option value="Biologi">Biologi</option>
            <option value="Bahasa Indonesia">Bahasa Indonesia</option>
            <option value="Bahasa Inggris">Bahasa Inggris</option>
            <option value="Ekonomi">Ekonomi</option>
            <option value="Sejarah">Sejarah</option>
          </select>

          <label for="tanggal">Tanggal Peminjaman</label>
          <input type="date" id="tanggal" name="tanggal" required />
        `;
      }

      fasilitasSection.style.display = "block";
    });

    document.getElementById("formulirPeminjaman").addEventListener("submit", function(e) {
      e.preventDefault();

      const peran = document.getElementById("peran").value;
      const fasilitas = document.getElementById("fasilitas").value;
      const subFasilitas = subFasilitasSelect.value || "";
      const tanggal = document.getElementById("tanggal").value;
      const jamMulai = document.getElementById("jamMulai").value;
      const jamSelesai = document.getElementById("jamSelesai").value;
      const keterangan = document.getElementById("keterangan").value;

      let semuaData = JSON.parse(localStorage.getItem("semuaPeminjaman")) || [];

      const namaFasilitasLengkap = subFasilitas ? `${fasilitas} - ${subFasilitas}` : fasilitas;

      const bentrok = semuaData.some(data =>
        data.fasilitas === namaFasilitasLengkap &&
        data.tanggal === tanggal &&
        !(jamSelesai <= data.jamMulai || jamMulai >= data.jamSelesai)
      );

      if (bentrok) {
        alert("‚ùå Jadwal sudah dipinjam! Silakan pilih waktu lain.");
        return;
      }

      const dataFormulir = { peran, fasilitas: namaFasilitasLengkap, tanggal, jamMulai, jamSelesai, keterangan };

      if (peran === "siswa") {
        dataFormulir.nama = document.getElementById("nama").value;
        dataFormulir.kelas = document.getElementById("kelas").value;
        dataFormulir.absen = document.getElementById("absen").value;
      } else {
        dataFormulir.nama = document.getElementById("nama").value;
        dataFormulir.mapel = document.getElementById("mapel").value;
      }

      semuaData.push(dataFormulir);
      localStorage.setItem("semuaPeminjaman", JSON.stringify(semuaData));
      localStorage.setItem("kartuPeminjaman", JSON.stringify(dataFormulir));

      if (peran === "siswa") {
        window.location.href = "kartu_siswa.html";
      } else {
        window.location.href = "kartu_guru.html";
      }
    });
  </script>

</body>
</html>
